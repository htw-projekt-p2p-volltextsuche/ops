version: "3.7"
services:
    mongo:
        image: mongo
        ports:
            - "8430:27017"
        volumes: 
            - "~/mongo/data:/data/db"
        environment:
            MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
            MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
    crawler:
        image: zinkl/crawler
        environment:
            MongoConnectionString: "mongodb://${MONGO_INITDB_ROOT_USERNAME}:${MONGO_INITDB_ROOT_PASSWORD}@${DATA_HOST}:8430"
            IndexingApiEndpoint: "http://${DATA_HOST}:8421/api"
            InitialDelay: 90
        volumes: 
            - "~/crawler/data:/app/data"
    fulltext-search:
        image: zinkl/fulltext-search
        ports:
            - "8421:8421"
        environment:
            INDEX_STORAGE_POLICY: ${INDEX_STORAGE_POLICY}
            CONFIG_FORCE_PEERS_URI: "0.0.0.0"
            CONFIG_FORCE_PEERS_LOG__BODY: ${CONFIG_FORCE_PEERS_LOG__BODY}
            CONFIG_FORCE_SERVER_LOG__BODY: ${CONFIG_FORCE_SERVER_LOG__BODY}
    p2pframework:
        image: zinkl/p2p-dht
        ports:
            - "8070:8070"
            - "8090:8090"
        environment:
            PEER_LIST: ${PEER_LIST}
            PEER_IP: "0.0.0.0"
        volumes: 
            - "~/p2p/data:/tmp/datastore"
    userinterface:
        image: zinkl/p2p-userinterface
        ports:
            - "8080:3000"
        environment:
            MongoConnectionString: "mongodb://${MONGO_INITDB_ROOT_USERNAME}:${MONGO_INITDB_ROOT_PASSWORD}@${DATA_HOST}:8430"